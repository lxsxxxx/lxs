<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>åœ¨çº¿è´­ç‰©æŠ˜æ‰£ç½‘ç«™</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    .clock { font-size: 20px; margin-bottom: 10px; }
    .tips { margin-top: 10px; color: green; }
    table, th, td { border: 1px solid black; border-collapse: collapse; padding: 5px; }
  </style>
</head>
<body>

<h2>åœ¨çº¿è´­ç‰©æŠ˜æ‰£ç³»ç»Ÿ</h2>
<div class="clock" id="clock"></div>
<div id="timeDiscountTip"></div>

<script>
  // æ¨¡æ‹Ÿæ—¶é’Ÿ + æ—¶é—´æŠ˜æ‰£æé†’
  function updateClock() {
    const now = new Date();
    const h = now.getHours();
    const m = now.getMinutes();
    const s = now.getSeconds();
    const timeStr = `${h}:${m < 10 ? '0' + m : m}:${s < 10 ? '0' + s : s}`;
    document.getElementById('clock').innerText = `å½“å‰æ—¶é—´ï¼š${timeStr}`;

    const tip = document.getElementById('timeDiscountTip');
    if (m >= 0 && m <= 9) {
      tip.innerHTML = '<p style="color:red;">âœ… å½“å‰å¤„äºæ¯å°æ—¶å‰10åˆ†é’Ÿï¼Œäº«å—85æŠ˜ï¼</p>';
    } else {
      tip.innerHTML = '<p>â³ å½“å‰æ— æ—¶é—´æŠ˜æ‰£</p>';
    }
  }
  setInterval(updateClock, 1000);
  updateClock();

  // é¡µé¢åŠ è½½æ—¶æé†’æŠ˜æ‰£
  document.write('<p style="color:blue;">ğŸ“¢ æ¬¢è¿è®¿é—®è´­ç‰©ç½‘ç«™ï¼æ¯å°æ—¶å‰10åˆ†é’Ÿäº«å—85æŠ˜ï¼ŒVIPç”¨æˆ·é¢å¤–9æŠ˜ï¼</p>');
</script>

<hr>

<form id="orderForm">
  å®¢æˆ·åç§°ï¼š<input type="text" id="customerName"><br>
  å•†å“å•ä»·ï¼š<input type="number" id="price" step="0.01"><br>
  æ•°é‡ï¼š<input type="number" id="quantity"><br>
  å®¢æˆ·ç±»å‹ï¼š
  <select id="isVip">
    <option value="false">æ™®é€šå®¢æˆ·</option>
    <option value="true">VIPå®¢æˆ·</option>
  </select><br>
  æ˜¯å¦åŠ æ€¥ï¼š
  <select id="isUrgent">
    <option value="false">å¦</option>
    <option value="true">æ˜¯</option>
  </select><br>
  <button type="button" onclick="addOrder()">æ·»åŠ è®¢å•</button>
</form>

<div class="tips" id="tips"></div>

<hr>

<h3>å–å®¶æˆäº¤å†å²</h3>
<div id="dashboard"></div>

<script>
  let history = [];

  function addOrder() {
    const name = document.getElementById('customerName').value.trim();
    const price = parseFloat(document.getElementById('price').value);
    const quantity = parseInt(document.getElementById('quantity').value);
    const isVip = document.getElementById('isVip').value === 'true';
    const isUrgent = document.getElementById('isUrgent').value === 'true';

    // æ ¡éªŒ
    if (!name) { alert('å®¢æˆ·åç§°ä¸èƒ½ä¸ºç©º'); return; }
    if (isNaN(price) || price <= 0) { alert('å•ä»·å¿…é¡»æ˜¯å¤§äº0çš„æ•°å­—'); return; }
    if (isNaN(quantity) || quantity <= 0 || quantity % 1 !== 0) { alert('æ•°é‡å¿…é¡»æ˜¯å¤§äº0çš„æ•´æ•°'); return; }

    const now = new Date();
    const minute = now.getMinutes();
    const hitTimeDiscount = minute >= 0 && minute <= 9;

    let baseTotal = price * quantity;
    let afterVip = isVip ? baseTotal * 0.9 : baseTotal;
    let afterUrgent = isUrgent ? afterVip * 1.1 : afterVip;

    let finalTotal = afterUrgent;
    if (hitTimeDiscount) finalTotal *= 0.85;

    // âœ… å­¦å·å°¾å·8ä¸“å±é€»è¾‘ï¼šæ™®é€šå®¢æˆ· >200 å‡10å…ƒ
    if (!isVip && finalTotal > 200) {
      finalTotal -= 10;
      if (finalTotal < 0) finalTotal = 0;
    }

    // æ„å»ºæç¤º
    let tipsHtml = `<p>âœ… è®¢å•æˆåŠŸï¼</p>`;
    tipsHtml += `<p>å®¢æˆ·ï¼š${name}</p>`;
    tipsHtml += `<p>åŸºç¡€æ€»ä»·ï¼šÂ¥${baseTotal.toFixed(2)}</p>`;
    if (isVip) tipsHtml += `<p>VIPæŠ˜æ‰£åï¼šÂ¥${afterVip.toFixed(2)}</p>`;
    if (isUrgent) tipsHtml += `<p>åŠ æ€¥è´¹åï¼šÂ¥${afterUrgent.toFixed(2)}</p>`;
    if (hitTimeDiscount) tipsHtml += `<p>æ—¶é—´æŠ˜æ‰£åï¼šÂ¥${finalTotal.toFixed(2)}</p>`;
    if (!isVip && finalTotal > 200) tipsHtml += `<p>æ™®é€šå®¢æˆ·æ»¡200å‡10åï¼šÂ¥${finalTotal.toFixed(2)}</p>`;
    tipsHtml += `<p><strong>æœ€ç»ˆæ€»ä»·ï¼šÂ¥${finalTotal.toFixed(2)}</strong></p>`;

    document.getElementById('tips').innerHTML = tipsHtml;

    // æ·»åŠ åˆ°å†å²è®°å½•
    history.push({ name, price, quantity, isVip, isUrgent, finalTotal });
    renderDashboard();
  }

  function renderDashboard() {
    let html = '<table><tr><th>å®¢æˆ·</th><th>å•ä»·</th><th>æ•°é‡</th><th>VIP</th><th>åŠ æ€¥</th><th>æˆäº¤ä»·</th></tr>';
    for (let o of history) {
      html += `<tr>
        <td>${o.name}</td>
        <td>Â¥${o.price.toFixed(2)}</td>
        <td>${o.quantity}</td>
        <td>${o.isVip ? 'æ˜¯' : 'å¦'}</td>
        <td>${o.isUrgent ? 'æ˜¯' : 'å¦'}</td>
        <td>Â¥${o.finalTotal.toFixed(2)}</td>
      </tr>`;
    }
    html += '</table>';
    document.getElementById('dashboard').innerHTML = html;
  }
</script>

</body>
</html>